<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Logic Note Generator (Safe Batch Edition)</title>
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- XLSX Library for Excel Processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Nanum Gothic Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Nanum Gothic', sans-serif; background-color: #f3f4f6; }
        
        /* 인쇄 설정 - A4 최적화 및 페이지 나누기 */
        @media print {
            body { background-color: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-container { 
                box-shadow: none !important; 
                margin: 0 !important; 
                width: 100% !important; 
                height: 100% !important;
                padding: 0 !important;
                border: none !important;
                page-break-after: always; /* 각 학습지마다 페이지 나누기 강제 */
            }
            .print-container:last-child {
                page-break-after: auto;
            }
            @page { margin: 0; size: A4; }
        }
        
        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Demo Data ---
        const DEMO_INPUT = `The soil of a farm field / is forced to be the perfect environment / for monoculture growth.
This is achieved by adding nutrients / in the form of fertilizer / and water by way of irrigation.
During the last fifty years, / engineers and crop scientists / have helped farmers become much more efficient / at supplying exactly the right amount of both.
World usage of fertilizer has tripled since 1969, / and the global capacity for irrigation has almost doubled; / we are feeding and watering our fields more than ever, / and our crops are loving it.
Unfortunately, / these luxurious conditions / have also excited the attention / of certain agricultural undesirables.
Because farm fields are loaded with nutrients and water / relative to the natural land that surrounds them, / they are desired as luxury real estate / by every random weed in the area.`;

        // --- Components ---

        function App() {
            // Mode: 'single' or 'batch'
            const [mode, setMode] = useState('single');
            
            // Single Mode State
            const [singleInput, setSingleInput] = useState(DEMO_INPUT);
            const [singleSource, setSingleSource] = useState('');
            const [singleResult, setSingleResult] = useState(null);
            
            // Batch Mode State
            // Item structure: { id, text, source, result, status: 'idle'|'loading'|'success'|'error', errorMsg, selected: boolean }
            const [batchItems, setBatchItems] = useState([]); 
            const [isProcessingBatch, setIsProcessingBatch] = useState(false);
            const [processingStatusMsg, setProcessingStatusMsg] = useState("");

            // Common State
            const [apiKey, setApiKey] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const savedKey = localStorage.getItem('gemini_api_key');
                if (savedKey) setApiKey(savedKey);
            }, []);

            const handleApiKeyChange = (e) => {
                const newKey = e.target.value;
                setApiKey(newKey);
                localStorage.setItem('gemini_api_key', newKey);
            };

            // --- API Call Function ---
            const callGeminiAPI = async (rawText) => {
                let text = rawText ? String(rawText).trim() : "";
                text = text.replace(/^[\s"'\\[]+|[\s"'\\]]+$/g, '');

                const prompt = `
                    You are a strict logic structurer creating an "Answer Key" for High School Grade 1 students.
                    Analyze the text and summarize it into a logical structure (A vs B or Flow).

                    Text: """${text}"""

                    Output Format: JSON only.
                    
                    CRITICAL CONSTRAINTS FOR A4 LAYOUT:
                    1. **Item Limit**: EXACTLY 3 items per section. No more, no less.
                    2. **Meaningful Context**: Do NOT use single keywords. Use short phrases like "**Subject + Key Attribute**" to provide context.
                       - Bad: "Increase"
                       - Good: "Productivity drastically increases"
                       - Bad: "Fertilizer"
                       - Good: "Farmers adding fertilizer"
                    3. **Language**: **Korean Meaning (English Term)** format.
                    4. **Strict Quoting**: The English term inside parentheses MUST be a **direct quote (verbatim)** from the input text.
                    5. **Translation Rule (CRITICAL)**: 
                       - Translate abstract nouns/concepts into natural Korean words.
                       - Do NOT use transliteration unless it is a standard loanword.

                    Structure constraints:
                    - "contrast": Comparing two concepts (A vs B).
                    - "flow": Cause -> Effect, or Problem -> Solution. Even for flow, create two distinct sections.
                    
                    JSON Schema:
                    {
                        "titleKo": "Topic Title (Korean)",
                        "titleEn": "Topic Title (English)",
                        "type": "contrast" or "flow",
                        "sectionA": {
                            "title": "Concept A Title (e.g. Cause, Problem)",
                            "items": [ { "text": "Subject/Context in Korean (Exact English Quote)", "sub": "Short elaboration", "symbol": "=" } ],
                            "conclusion": "Summary of Section A (Subject + Outcome)"
                        },
                        "sectionB": {
                            "title": "Concept B Title (e.g. Effect, Solution)",
                            "items": [],
                            "conclusion": "Summary of Section B (Subject + Outcome)"
                        },
                        "finalConclusion": {
                            "main": "Main Result / Takeaway",
                            "sub": "Implication or Final Thought"
                        }
                    }
                `;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    // Check for rate limit (429)
                    if (response.status === 429) {
                        throw new Error("RATE_LIMIT");
                    }
                    const errData = await response.json();
                    throw new Error(errData.error?.message || "API Request Failed");
                }

                const data = await response.json();
                let textResponse = data.candidates[0].content.parts[0].text;
                textResponse = textResponse.replace(/```json/g, '').replace(/```/g, '').trim();
                return JSON.parse(textResponse);
            };

            // --- Single Mode Handlers ---
            const handleSingleAnalyze = async () => {
                if (!apiKey) { setError("API Key Required"); return; }
                setLoading(true);
                setError(null);
                try {
                    const result = await callGeminiAPI(singleInput);
                    setSingleResult(result);
                } catch (err) {
                    setError("분석 실패: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            // --- Batch Mode Handlers ---
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary' });
                    const wsname = wb.SheetNames[0];
                    const ws = wb.Sheets[wsname];
                    const data = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    
                    const items = data.map((row, index) => ({
                        id: index,
                        source: row[0] || '', // A열
                        text: row[1],         // B열
                        result: null,
                        status: 'idle',
                        errorMsg: null,
                        selected: true 
                    })).filter(item => item.text && String(item.text).trim() !== '');

                    setBatchItems(items);
                };
                reader.readAsBinaryString(file);
            };

            const toggleSelection = (id) => {
                setBatchItems(prev => prev.map(item => 
                    item.id === id ? { ...item, selected: !item.selected } : item
                ));
            };

            const toggleAll = (selectAll) => {
                setBatchItems(prev => prev.map(item => ({ ...item, selected: selectAll })));
            };

            // Robust Batch Processing with Rate Limit Handling
            const processBatch = async () => {
                if (!apiKey) { setError("API Key Required for Batch Processing"); return; }
                setIsProcessingBatch(true);
                setError(null);
                setProcessingStatusMsg("분석 시작...");

                let currentItems = [...batchItems];
                
                // Get items that need processing
                const itemsToProcess = currentItems
                    .map((item, idx) => ({ idx, ...item }))
                    .filter(item => item.selected && item.status !== 'success');

                for (let i = 0; i < itemsToProcess.length; i++) {
                    const itemWrapper = itemsToProcess[i];
                    const idx = itemWrapper.idx;
                    
                    // Set loading status
                    currentItems[idx].status = 'loading';
                    setBatchItems([...currentItems]);
                    
                    let success = false;
                    let retries = 0;
                    const maxRetries = 5; // 최대 5번 재시도

                    while (!success && retries < maxRetries) {
                        try {
                            // Update Status Message
                            setProcessingStatusMsg(`처리 중: ${i + 1}/${itemsToProcess.length} (항목 ID: ${idx+1}) ${retries > 0 ? `- 재시도 ${retries}회` : ''}`);
                            
                            const result = await callGeminiAPI(currentItems[idx].text);
                            currentItems[idx].result = result;
                            currentItems[idx].status = 'success';
                            currentItems[idx].errorMsg = null;
                            success = true;
                            
                            // Success -> Save and Short Wait
                            setBatchItems([...currentItems]);
                            // 3 seconds cool down between successful requests to be safe
                            await new Promise(r => setTimeout(r, 3000)); 

                        } catch (err) {
                            console.warn(`Error processing item ${idx}:`, err);
                            
                            if (err.message === "RATE_LIMIT" || err.message.includes("429")) {
                                setProcessingStatusMsg(`⚠️ 사용량 제한 감지. 10초 대기 후 재시도 중...`);
                                // Wait 10 seconds for Rate Limit
                                await new Promise(r => setTimeout(r, 10000));
                                retries++;
                            } else {
                                // Other errors: Wait 2 seconds and retry
                                await new Promise(r => setTimeout(r, 2000));
                                retries++;
                            }
                        }
                    }

                    if (!success) {
                        currentItems[idx].status = 'error';
                        currentItems[idx].errorMsg = "최대 재시도 초과";
                        setBatchItems([...currentItems]);
                    }
                }

                setProcessingStatusMsg("모든 작업 완료!");
                setIsProcessingBatch(false);
            };

            const handlePrint = () => {
                window.print();
            };

            const selectedCount = batchItems.filter(i => i.selected).length;
            const successCount = batchItems.filter(i => i.status === 'success' && i.selected).length;
            const totalSuccess = batchItems.filter(i => i.status === 'success').length;

            return (
                <div className="min-h-screen pb-10 print:pb-0 bg-gray-50">
                    <div className="no-print bg-white shadow-sm border-b p-6 mb-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-indigo-600"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
                                    AI 구조화 노트 {mode === 'batch' && '(안전 일괄 처리 모드)'}
                                </h1>
                                <div className="flex gap-2 bg-gray-100 p-1 rounded-lg">
                                    <button onClick={() => setMode('single')} className={`px-4 py-2 text-sm font-bold rounded-md transition ${mode === 'single' ? 'bg-white shadow text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}>개별 입력</button>
                                    <button onClick={() => setMode('batch')} className={`px-4 py-2 text-sm font-bold rounded-md transition ${mode === 'batch' ? 'bg-white shadow text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}>엑셀 일괄 처리</button>
                                </div>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Gemini API Key <span className="text-xs font-normal text-gray-500 ml-2">(입력 시 자동 저장됨)</span></label>
                                    <input type="password" className="w-full p-2 border rounded-lg text-sm focus:ring-2 focus:ring-indigo-500" value={apiKey} onChange={handleApiKeyChange} placeholder="API 키 입력 (자동 저장)" />
                                </div>

                                {mode === 'single' ? (
                                    <>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">분석할 지문 (Text)</label>
                                            <textarea className="w-full p-3 border rounded-lg h-32 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" value={singleInput} onChange={(e) => setSingleInput(e.target.value)} placeholder="여기에 영어 지문을 붙여넣으세요..." />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">출처 (선택사항)</label>
                                            <input type="text" className="w-full p-2 border rounded-lg text-sm focus:ring-2 focus:ring-indigo-500" value={singleSource} onChange={(e) => setSingleSource(e.target.value)} placeholder="예: 2024년 3월 고1 모의고사 31번" />
                                        </div>
                                        <button onClick={handleSingleAnalyze} disabled={loading} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition disabled:bg-gray-300 flex justify-center items-center gap-2">
                                            {loading ? "AI 분석 중..." : "구조화 답안지 생성"}
                                        </button>
                                    </>
                                ) : (
                                    <div className="bg-white rounded-lg border-2 border-dashed border-gray-300 p-6 text-center">
                                        <div className="mb-4">
                                            <svg className="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" /></svg>
                                            <p className="mt-1 text-sm text-gray-600">엑셀 파일(.xlsx)을 업로드하세요</p>
                                            <p className="text-xs text-gray-500 mt-1">A열: 출처, B열: 영어 지문 (1행부터 데이터로 인식합니다)</p>
                                        </div>
                                        <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept=".xlsx, .xls" className="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 mb-4" />
                                        
                                        {batchItems.length > 0 && (
                                            <div className="text-left mb-4">
                                                <div className="flex justify-between items-center text-sm font-medium text-gray-700 mb-2">
                                                    <span>총 {batchItems.length}개 지문 (선택됨: {selectedCount})</span>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => toggleAll(true)} className="text-xs text-indigo-600 hover:text-indigo-800 underline">전체 선택</button>
                                                        <button onClick={() => toggleAll(false)} className="text-xs text-gray-500 hover:text-gray-700 underline">전체 해제</button>
                                                    </div>
                                                </div>
                                                
                                                <div className="mt-2 text-xs text-gray-500 max-h-60 overflow-y-auto border rounded-lg bg-gray-50">
                                                    {batchItems.map((item, idx) => (
                                                        <div key={idx} className={`flex items-center gap-3 p-2 border-b last:border-0 ${!item.selected ? 'opacity-50' : ''}`}>
                                                            <input 
                                                                type="checkbox" 
                                                                checked={item.selected} 
                                                                onChange={() => toggleSelection(item.id)}
                                                                disabled={isProcessingBatch}
                                                                className="h-4 w-4 text-indigo-600 rounded cursor-pointer"
                                                            />
                                                            <span className="w-6 font-bold text-gray-400">{idx + 1}.</span>
                                                            <span className="font-semibold text-blue-600 w-1/4 truncate" title={item.source}>{item.source || '(출처없음)'}</span>
                                                            <span className="truncate flex-1" title={item.text}>{item.text.substring(0, 40)}...</span>
                                                            <span className="w-24 text-right font-bold text-[11px]">
                                                                {item.status === 'loading' && '⏳ 처리중...'}
                                                                {item.status === 'success' && '✅ 완료'}
                                                                {item.status === 'error' && '❌ 실패(Retry)'}
                                                                {item.status === 'idle' && '대기'}
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                                {/* 진행률 표시 */}
                                                {isProcessingBatch && (
                                                    <div className="mt-2">
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div className="bg-indigo-600 h-2 rounded-full transition-all duration-300" style={{ width: `${(successCount / selectedCount) * 100}%` }}></div>
                                                        </div>
                                                        <div className="flex justify-between mt-1 text-xs text-gray-500">
                                                            <span>{processingStatusMsg}</span>
                                                            <span>{Math.round((successCount / selectedCount) * 100)}%</span>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        <button 
                                            onClick={processBatch} 
                                            disabled={isProcessingBatch || selectedCount === 0} 
                                            className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition disabled:bg-gray-300 flex justify-center items-center gap-2"
                                        >
                                            {isProcessingBatch ? "안전 모드로 분석 중..." : `선택한 지문(${selectedCount}개) 분석 시작`}
                                        </button>
                                    </div>
                                )}
                                
                                {error && <p className="text-red-500 text-sm font-medium bg-red-50 p-3 rounded">{error}</p>}
                            </div>
                        </div>
                    </div>

                    {/* Result Display Area */}
                    <div className="mx-auto">
                        {mode === 'single' && singleResult && (
                            <div className="max-w-[210mm] mx-auto print-container bg-white shadow-lg">
                                <div className="no-print flex justify-end p-4 border-b bg-gray-50">
                                    <button onClick={handlePrint} className="bg-gray-800 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-gray-700">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                                        인쇄하기
                                    </button>
                                </div>
                                <Worksheet data={singleResult} source={singleSource} />
                            </div>
                        )}

                        {mode === 'batch' && totalSuccess > 0 && (
                            <div>
                                <div className="no-print max-w-4xl mx-auto mb-4 flex justify-between items-center px-4">
                                    <h2 className="text-xl font-bold text-gray-800">분석 완료 결과 ({totalSuccess}건)</h2>
                                    <button onClick={handlePrint} className="bg-gray-800 text-white px-6 py-3 rounded-lg text-base font-bold flex items-center gap-2 hover:bg-gray-700 shadow-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                                        전체 인쇄 (Print All)
                                    </button>
                                </div>
                                
                                <div className="flex flex-col items-center gap-8 print:block print:gap-0">
                                    {batchItems.map((item) => (
                                        item.status === 'success' && item.result ? (
                                            <div key={item.id} className="max-w-[210mm] w-full bg-white shadow-lg print:shadow-none print-container">
                                                <Worksheet data={item.result} source={item.source} />
                                            </div>
                                        ) : null
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- Visualization Component (Same as before) ---
        function Worksheet({ data, source }) {
            const getBoxStyle = () => ({ border: 'border-gray-800', bg: 'bg-white', text: 'text-blue-700' });
            const isContrast = data.type === 'contrast';
            const style = getBoxStyle();

            return (
                <div className="w-[210mm] h-[297mm] p-6 box-border relative flex flex-col justify-center overflow-hidden bg-white">
                    
                    {source && (
                        <div className="absolute top-6 left-6 text-sm font-bold text-gray-500">
                            {source}
                        </div>
                    )}

                    <div className="text-center mb-4">
                         <h1 className="text-2xl font-extrabold text-blue-800 leading-tight mb-1">
                            {data.titleKo}
                        </h1>
                        {data.titleEn && (
                            <div className="text-base font-bold text-gray-500">
                                {data.titleEn}
                            </div>
                        )}
                    </div>

                    <div className="flex gap-4 items-stretch">
                        
                        <div className={`flex-1 border-2 rounded-xl p-4 ${style.border} ${style.bg} flex flex-col`}>
                            <h2 className={`text-lg font-bold mb-3 pb-2 border-b border-black/10 text-center ${style.text}`}>
                                {data.sectionA.title}
                            </h2>
                            <ul className="space-y-2 flex-grow">
                                {data.sectionA.items.map((item, idx) => (
                                    <li key={idx} className="text-gray-900 leading-snug pl-4 relative text-[13.5px] break-words">
                                        <span className="font-bold absolute left-0 text-gray-400">•</span>
                                        <span className="font-bold">{item.text.split('(')[0]}</span>
                                        {item.text.includes('(') && <span className="block text-xs text-gray-500 mt-0.5 font-medium leading-tight">{`(${item.text.split('(')[1]}`}</span>}
                                        {item.sub && <div className="text-[11px] text-gray-500 mt-1 bg-gray-100 inline-block px-1.5 py-0.5 rounded border border-gray-200">{item.sub}</div>}
                                    </li>
                                ))}
                            </ul>
                            {data.sectionA.conclusion && (
                                <div className="mt-3 pt-2 border-t border-black/10 text-center">
                                    <div className="text-[10px] text-gray-500 mb-0.5 uppercase tracking-wider font-bold">핵심 요약 (Key Point)</div>
                                    <div className="font-extrabold text-gray-800 text-base">{data.sectionA.conclusion}</div>
                                </div>
                            )}
                        </div>

                        <div className="flex flex-col justify-center items-center w-8 shrink-0 relative">
                            {isContrast ? (
                                <>
                                    <div className="absolute inset-y-0 w-px border-l-2 border-dashed border-gray-300 left-1/2 -translate-x-1/2"></div>
                                    <div className="z-10 bg-white p-1.5 rounded-full border-2 border-gray-800 shadow-sm text-sm font-extrabold text-gray-800 relative">VS</div>
                                </>
                            ) : (
                                <div className="z-10 bg-white p-1 rounded-full border border-gray-200 shadow-sm text-lg my-2 text-gray-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                </div>
                            )}
                        </div>

                        <div className={`flex-1 border-2 rounded-xl p-4 ${style.border} ${style.bg} flex flex-col`}>
                            <h2 className={`text-lg font-bold mb-3 pb-2 border-b border-black/10 text-center ${style.text}`}>
                                {data.sectionB.title}
                            </h2>
                            <ul className="space-y-2 flex-grow">
                                {data.sectionB.items.map((item, idx) => (
                                    <li key={idx} className="text-gray-900 leading-snug pl-4 relative text-[13.5px] break-words">
                                        <span className="font-bold absolute left-0 text-gray-400">•</span>
                                        <span className="font-bold">{item.text.split('(')[0]}</span>
                                        {item.text.includes('(') && <span className="block text-xs text-gray-500 mt-0.5 font-medium leading-tight">{`(${item.text.split('(')[1]}`}</span>}
                                        {item.sub && <div className="text-[11px] text-gray-500 mt-1 bg-gray-100 inline-block px-1.5 py-0.5 rounded border border-gray-200">{item.sub}</div>}
                                    </li>
                                ))}
                            </ul>
                            {data.sectionB.conclusion && (
                                <div className="mt-3 pt-2 border-t border-black/10 text-center">
                                    <div className="text-[10px] text-gray-500 mb-0.5 uppercase tracking-wider font-bold">핵심 요약 (Key Point)</div>
                                    <div className="font-extrabold text-gray-800 text-base">{data.sectionB.conclusion}</div>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="mt-4">
                        <div className="flex justify-center mb-[-10px] relative z-10">
                             <div className="bg-rose-700 text-white text-[10px] px-3 py-0.5 rounded-full uppercase tracking-wider font-bold border-2 border-white">Main Conclusion</div>
                        </div>
                        <div className="border-2 border-gray-800 rounded-xl p-4 text-center bg-white relative">
                             <div className="text-lg font-extrabold text-rose-700 mb-1">{data.finalConclusion.main}</div>
                             <div className="text-gray-600 font-medium text-sm">{data.finalConclusion.sub}</div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>